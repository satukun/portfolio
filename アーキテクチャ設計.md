# アーキテクチャ設計詳細

## 🏗️ 全体アーキテクチャ

### システム概要図
```
Frontend (Next.js)    ←→    CMS (microCMS)    ←→    Deploy (Vercel)
├── Server Components ←→    ├── Blog API      ←→    ├── Auto Deploy
├── Client Components ←→    ├── Works API     ←→    ├── Edge Network  
├── Static Assets     ←→    ├── Tags API      ←→    ├── ISR Cache
└── API Routes        ←→    └── Categories    ←→    └── Environment Variables
```

## 📂 ディレクトリ構造（Next.js App Router）

### 推奨構造準拠
```
src/
├── app/                    # App Router (ページ・API)
│   ├── blog/              # ブログ機能
│   │   ├── page.tsx       # 記事一覧
│   │   ├── [slug]/        # 個別記事
│   │   ├── category/[slug]/ # カテゴリ別一覧
│   │   └── tag/[slug]/    # タグ別一覧
│   ├── api/               # APIエンドポイント
│   │   └── blog/sidebar/  # サイドバーデータ取得
│   ├── layout.tsx         # 共通レイアウト
│   ├── page.tsx           # トップページ
│   ├── globals.css        # グローバルスタイル
│   └── robots.ts, sitemap.ts # SEO設定
│
├── components/            # UI コンポーネント
│   ├── common/           # 共通コンポーネント
│   │   ├── animations/   # アニメーション
│   │   ├── buttons/      # ボタン
│   │   └── notifications/ # 通知システム
│   ├── features/         # 機能別コンポーネント
│   │   ├── blog/         # ブログ関連
│   │   ├── contact/      # お問い合わせ関連
│   │   ├── portfolio/    # ポートフォリオ関連
│   │   ├── tech-stack/   # 技術スタック関連
│   │   └── works/        # 制作実績関連
│   └── layouts/          # レイアウトコンポーネント
│       ├── Header.tsx
│       ├── Footer.tsx
│       ├── PageWrapper.tsx # 通知プロバイダー
│       └── SmoothScroll.tsx
│
├── dal/                  # Data Access Layer
│   ├── blog/            # ブログデータアクセス
│   ├── works/           # Works データアクセス
│   └── microcms-client.ts # 基盤APIクライアント
│
├── lib/                  # ユーティリティ・型定義
│   ├── contexts/        # React Context
│   │   └── NotificationContext.tsx # 通知管理
│   ├── types/           # 型定義
│   │   ├── common.ts    # 共通型
│   │   ├── blog.ts      # ブログ型
│   │   ├── contact.ts   # お問い合わせ型
│   │   ├── work.ts      # Works型
│   │   └── tech-stack.ts # 技術スタック型
│   ├── utils/           # ヘルパー関数
│   │   ├── date.ts      # 日付処理
│   │   └── tech-level.ts # 技術レベル
│   ├── validation/      # バリデーション
│   │   └── contact.ts   # お問い合わせフォーム
│   └── constants/       # 定数定義
│       └── tech-stack-data.ts
│
└── public/              # 静的アセット
    ├── profile_image/   # プロフィール画像
    ├── favicon.ico      # ファビコン
    └── ogp.png          # OGP画像
```

## ⚙️ コンポーネント設計パターン

### Server/Client Components 分離
```
Server Components (データフェッチ・SEO):
├── page.tsx (全ページ)
├── HeroSection.tsx
├── ProfileSection.tsx  
├── TechStackSection.tsx
├── WorksSection.tsx (async データフェッチ)
├── BlogSection.tsx
├── FollowSection.tsx
├── BlogCard.tsx
├── BlogContent.tsx
└── BlogList.tsx

Client Components (状態管理・インタラクション):
├── HomeClient.tsx (技術スタックパネル状態)
├── Header.tsx (ナビゲーション状態)
├── BlogSidebar.tsx (動的データフェッチ)
├── WorksClient.tsx (スライドパネル状態)
├── ContactSection.tsx (フォーム状態管理)
├── ContactForm.tsx (React Hook Form)
├── ContactConfirmationModal.tsx (確認モーダル)
├── ThemeSwitcher.tsx (テーマ状態)
├── Particles.tsx (Canvas アニメーション)
└── 各種 Modal・SlidePanel
```

### データフェッチパターン
```
Server-side Fetching:
├── トップページ: dal.blog.getLatestPosts(3)
├── ブログ一覧: dal.blog.getBlogPosts() + pagination
├── 個別記事: dal.blog.getBlogPostBySlug()
├── カテゴリ一覧: カテゴリフィルタリング
├── タグ一覧: クライアントサイドフィルタリング
└── Works: dal.works.getFeaturedWorks() + getAllWorks()

Client-side Fetching:
├── サイドバー: /api/blog/sidebar (POST)
└── 動的インタラクション用のみ
```

## 🔄 状態管理戦略

### 状態の種類と管理方法
```
1. Server State (サーバーサイド)
├── ブログ記事データ: Server Components で取得
├── Works データ: Server Components で取得
├── 静的コンテンツ: props による受け渡し
└── メタデータ: generateMetadata() 

2. Client State (クライアントサイド)  
├── モーダル開閉: useState (個別管理)
├── テーマ設定: localStorage + useState
├── ナビゲーション: useState (Header)
└── サイドバーデータ: useState + useEffect

3. URL State (URL パラメータ)
├── ページ番号: ?page=1, ?page=2...
├── 記事スラッグ: /blog/[slug]
├── カテゴリ: /blog/category/[slug]
└── タグ: /blog/tag/[slug]
```

## 🎨 CSS アーキテクチャ

### スタイリング戦略
```
CSS Organization:
├── globals.css (単一ファイル)
│   ├── CSS Variables (テーマシステム)
│   ├── リセット・ベーススタイル
│   ├── 共通コンポーネントスタイル
│   ├── レスポンシブメディアクエリ
│   └── 機能別スタイル (blog-, works-, tech-)
│
├── CSS Variables System:
│   ├── カラーパレット (--color-primary, --color-accent-*)
│   ├── レイアウト (--container, --radius, --shadow)
│   ├── ブレークポイント (--bp-xl, --bp-lg, --bp-md, --bp-sm)
│   └── フォント (--font-noto-sans-jp, --font-montserrat)
│
└── Component-specific:
    ├── .blog-* (ブログ関連)
    ├── .works-* (Works関連)
    ├── .tech-* (技術スタック関連)
    └── .pagination-* (ページネーション)
```

### レスポンシブ設計
```
Responsive Strategy:
├── Mobile First アプローチ
├── CSS Grid (メインレイアウト)
├── Flexbox (詳細レイアウト)
├── clamp() (スケーラブルサイズ)
├── Container Queries (将来対応)
└── Aspect Ratio (画像アスペクト比)
```

## 🔐 型定義アーキテクチャ

### 型継承システム
```
Type Hierarchy:
├── BaseEntity (ID + 日時フィールド)
│   ├── BaseContent (+ title, slug, isPublished)
│   │   ├── BlogPost (ブログ記事)
│   │   └── WorkItem (制作実績)
│   ├── BlogTag (タグ)
│   └── BlogCategory (カテゴリ)
│
├── API型:
│   ├── APIResponse<T> (統一レスポンス)
│   ├── APIQueryParams (統一クエリ)
│   └── BlogListQuery (ブログ専用クエリ)
│
└── Component Props型:
    ├── BlogSectionProps
    ├── BlogCardProps
    ├── WorksClientProps
    └── BlogPaginationProps
```

## 🚀 パフォーマンス最適化設計

### レンダリング戦略
```
Rendering Strategy:
├── SSG (Static Site Generation)
│   ├── トップページ: 動的 + 静的データ混合
│   └── 記事詳細: generateStaticParams() 対応
│
├── ISR (Incremental Static Regeneration)
│   ├── revalidate: 300s (microCMS データ)
│   └── on-demand revalidation (Webhook 連携)
│
└── CSR (Client-Side Rendering)
    ├── サイドバーデータ (動的フェッチ)
    ├── モーダル・パネル (インタラクション)
    └── アニメーション (ユーザー体験)
```

### バンドル最適化
```
Bundle Optimization:
├── Tree Shaking (未使用コード削除)
├── Code Splitting (ページ別分割)
├── Dynamic Import (Modal等の遅延読み込み)
├── Image Optimization (next/image)
└── Font Optimization (Google Fonts)
```

## 🔄 API 設計

### RESTful API 構造
```
API Routes:
├── /api/blog/sidebar (POST only)
│   ├── 最新記事取得
│   ├── カテゴリカウント計算
│   └── タグカウント計算
│
└── /api/blog (POST only) - 将来の拡張用
    ├── 記事投稿 (将来)
    ├── 記事更新 (将来)  
    └── 記事削除 (将来)

External APIs:
└── microCMS
    ├── GET /blog (記事一覧)
    ├── GET /blog/{id} (個別記事)
    ├── GET /works (制作実績)
    ├── GET /tags (タグ一覧)
    └── GET /categories (カテゴリ一覧)
```

### エラーハンドリング戦略
```
Error Handling:
├── Server Components: try-catch + フォールバック
├── Client Components: useState(error) + UI表示
├── API Routes: NextResponse.json + HTTP status
├── 404 Pages: not-found.tsx + notFound()
└── Loading States: Suspense + skeleton UI
```

## 🎯 セキュリティ・環境管理

### 環境変数管理
```
Environment Variables:
├── .env.local (開発)
│   ├── MICROCMS_SERVICE_DOMAIN
│   ├── MICROCMS_API_KEY
│   └── NEXT_PUBLIC_SITE_URL
│
└── Vercel (本番)
    ├── Production環境
    ├── Preview環境
    └── Development環境
```

### セキュリティ対策
```
Security Measures:
├── API Key 管理: 環境変数による秘匿
├── CORS: Next.js デフォルト設定
├── Content Security Policy: headers 設定
├── XSS Protection: React 自動エスケープ
└── Rate Limiting: Vercel 標準機能
```

## 🔮 今後の拡張アーキテクチャ

### 認証・ユーザー管理
```
認証アーキテクチャ（Phase 1）
├── NextAuth.js 統合
│   ├── OAuth Providers（Google・GitHub）
│   ├── JWT Strategy（トークン管理）
│   ├── Session Management（セッション）
│   └── Middleware（認証ガード）
│
├── ユーザー関連コンポーネント
│   ├── components/features/auth/
│   │   ├── LoginForm.tsx
│   │   ├── RegisterForm.tsx
│   │   ├── ProfileEditor.tsx
│   │   └── PasswordReset.tsx
│   │
│   └── app/auth/
│       ├── login/page.tsx
│       ├── register/page.tsx
│       └── profile/page.tsx
│
└── 認証API Routes
    ├── app/api/auth/[...nextauth]/route.ts
    ├── app/api/user/profile/route.ts
    └── app/api/user/settings/route.ts
```

### 決済・サブスクリプション
```
決済アーキテクチャ（Phase 2）
├── Stripe 統合
│   ├── Payment Elements
│   ├── Subscription Management
│   ├── Webhook Processing
│   └── Invoice Generation
│
├── 決済関連コンポーネント
│   ├── components/features/payment/
│   │   ├── PricingTable.tsx
│   │   ├── CheckoutForm.tsx
│   │   ├── SubscriptionManager.tsx
│   │   └── InvoiceList.tsx
│   │
│   └── app/billing/
│       ├── plans/page.tsx
│       ├── checkout/page.tsx
│       └── subscription/page.tsx
│
└── 決済API Routes
    ├── app/api/stripe/checkout/route.ts
    ├── app/api/stripe/webhook/route.ts
    ├── app/api/subscription/manage/route.ts
    └── app/api/billing/invoices/route.ts
```

### データベース・ORM統合
```
データベースアーキテクチャ（Phase 3）
├── Database Selection
│   ├── PostgreSQL (Vercel Postgres)
│   ├── Redis (Upstash Redis)
│   └── File Storage (Vercel Blob)
│
├── ORM統合
│   ├── Prisma Schema
│   ├── Migration Management
│   ├── Type Generation
│   └── Query Optimization
│
└── Data Access Layer拡張
    ├── dal/database/
    │   ├── user.ts
    │   ├── subscription.ts
    │   ├── payment.ts
    │   └── analytics.ts
    │
    └── lib/database/
        ├── connection.ts
        ├── migrations/
        └── seeds/
```

### マイクロサービス展開
```
サービス分離アーキテクチャ（Phase 4）
├── Authentication Service
├── Payment Service  
├── Content Management Service
├── Analytics Service
└── Notification Service

API Gateway
├── Rate Limiting
├── Authentication Middleware
├── Request Logging
└── Error Handling
```

---

*Next.js App Router の推奨パターンに完全準拠し、スケーラブルで保守しやすいアーキテクチャを実現しています。今後は段階的にマイクロサービス化を進め、エンタープライズレベルのスケーラビリティを目指します。*
