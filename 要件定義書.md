# 要件定義書（初版）- YOUSUKE ポートフォリオサイト

最終更新: 2025-09-15
対象ブランチ: main（Next.js App Router 構成）

---

## 1. 背景・目的
- 本サイトはフロントエンドエンジニアとしての実績・知見を発信し、ブランディングと案件獲得ならびにコミュニティ貢献を目的とする。
- 技術選定は最新の Next.js 15 / React 19 / TypeScript を活用し、パフォーマンス・アクセシビリティ・保守性を重視。

## 2. ステークホルダー・想定ユーザー
- サイト所有者（YOUSUKE）: コンテンツ作成・運用、問い合わせ対応
- 一般訪問者: 記事閲覧、実績参照、問い合わせ送信
- 管理者（= 所有者）: microCMS 管理画面で記事・実績を管理

## 3. スコープ
- 対象: Web ポートフォリオ（トップ/ブログ/制作実績/問い合わせ/技術スタック表示）
- 非対象: 会員機能・決済機能・管理画面（CMS は microCMS を使用）

## 4. 用語定義
- microCMS: ヘッドレス CMS（記事・Works・タグ・カテゴリを管理）
- DAL: Data Access Layer（`src/dal`）で API 取得を集約
- App Router: Next.js のページ/ルーティング方式（`src/app`）

## 5. 前提・制約
- 技術: Next 15.5.2 / React 19.1.0 / TypeScript 5 / Node 18+
- デプロイ: Vercel（本番/プレビュー/開発の環境変数分離）
- CMS: microCMS（API キー・サービスドメイン必須）
- 環境変数: `MICROCMS_SERVICE_DOMAIN` `MICROCMS_API_KEY` `NEXT_PUBLIC_SITE_URL`
- ブラウザ: 最新の Chrome/Edge/Safari/Firefox、iOS/Android の主要バージョン

## 6. 画面・ページ要件（現状）
- `/` トップページ
  - セクション: Hero, Profile, Tech Stack, Works（注目3件）, Blog（最新3件）, Contact（フォーム+確認モーダル）, Follow
  - スムーズスクロール、スクロール連動アニメーション、パーティクル背景
- `/blog` ブログ一覧
  - 8件/ページのページネーション、カードレイアウト、サイドバー（最新記事/カテゴリ/タグ）
- `/blog/[slug]` 記事詳細
  - リッチテキスト表示、パンくず、関連記事（同タグ3件）
- `/blog/category/[slug]` カテゴリ別一覧
- `/blog/tag/[slug]` タグ別一覧
- SEO 自動生成: `robots.ts` `sitemap.ts`

## 7. ナビゲーション要件
- ヘッダー共通: Profile / Works / Blog / Contact / Follow
- モバイル: ハンバーガー + フルスクリーンメニュー
- テーマスイッチ: ダーク/ライト（localStorage 永続化）
- 技術スタック: ヘッダーの code ボタンからスライドパネル

## 8. 機能要件
- ブログ
  - 記事一覧/詳細/カテゴリ/タグの表示
  - ページネーション（8件/ページ）
  - サイドバー API から最新3件・カテゴリ/タグ件数取得
- Works（制作実績）
  - 注目3件（`isFeatured` 優先 + 不足は最新補完）
  - スライドパネル内フィルタ（All/Webアプリ/Webサイト）と詳細モーダル
- お問い合わせ
  - 入力: 名前/メール/本文、リアルタイムバリデーション
  - 確認モーダル → 最終送信（現状はデモ実装。送信 API は未実装）
- 技術スタック表示
  - カテゴリ別（フロント/開発・デプロイ/UX など）、習熟度バー表示
- 共通 UX
  - スムーズスクロール、Reveal アニメーション、スクロールトップボタン

## 9. 入力バリデーション要件（問い合わせ）
- 名前: 必須、2〜50文字
- メール: 必須、形式検証、100文字以下
- 本文: 必須、10〜1000文字
- エラーはリアルタイム表示、無効時は送信不可

## 10. API 要件
- 内部 API（現状）
  - `POST /api/blog/sidebar` 最新記事3件、カテゴリ/タグ件数を返却
  - `POST /api/contact` お問い合わせ送信（サーバーバリデーション + メール送信）
- 外部 API
  - microCMS v1: blog, works, tags, categories（GET）
  - Resend Emails API（任意）: 問い合わせ通知メール送信
- キャッシュ/再生成
  - Server Fetch はデフォルト `revalidate` を設定（基盤は60s）。ページは ISR 運用方針（5分を目安に調整可能）

## 11. データ要件（主要モデル）
- BlogPost
  - フィールド例: id, title, slug, content, excerpt, thumbnail{url}, tags[], category, isPublished, publishedAt, createdAt, updatedAt, authorName など
- BlogTag: id, name, slug
- BlogCategory: id, name, slug, description
- WorkItem
  - title, description, thumbnail(url|string), images[], techStack(string|string[]), category, year, type("Webアプリ"|"Webサイト"|string[]), duration, role, client, challenge, solution, result, liveUrl, githubUrl, status, isFeatured, order, isPublished

## 12. 非機能要件
- パフォーマンス
  - Core Web Vitals をグリーン水準、Lighthouse 95 目標
  - 画像最適化（`next/image`）、コード分割、動的 import
- セキュリティ
  - API Key は環境変数で秘匿、XSS は React による自動エスケープ
  - Vercel 側で標準的なレート制御・HTTPS 配信
- アクセシビリティ
  - ARIA 属性、キーボード操作、コントラスト/フォーカスリング配慮
- SEO
  - 動的メタデータ、OGP、サイトマップ/robots、自動構造化データ方針
- 可用性/運用性
  - Vercel 自動デプロイ、microCMS Webhook による更新反映
- 互換性
  - モダンブラウザの最新2バージョン、iOS/Android 主要対象

## 13. 運用・体制
- コンテンツ運用: microCMS で記事/Works を作成・公開管理
- デプロイ: Git Push → Vercel 自動デプロイ（プレビュー/本番）
- 監視/分析: GA 連携準備（導入は今後）、手動で Lighthouse 監視

## 14. 環境構成・セットアップ
- 必須環境: Node.js 18+, npm 9+
- 主要ライブラリ: next@15.5.2, react@19.1.0, microcms-js-sdk@3, react-hook-form@7, yup@1
- スクリプト:
  - `npm run dev`: 開発（Turbopack）
  - `npm run build`: 本番ビルド（Turbopack）
  - `npm start`: 本番起動
  - `npm run lint`: Lint 実行
- 環境変数:
  - `MICROCMS_SERVICE_DOMAIN`, `MICROCMS_API_KEY`, `NEXT_PUBLIC_SITE_URL`
  - `RESEND_API_KEY`（任意: Resend 利用時）
  - `CONTACT_TO_EMAIL`（通知先）
  - `CONTACT_FROM_EMAIL`（送信元: 例 `Portfolio <noreply@yourdomain>`）

## 15. テスト方針
- ビルド/型: TypeScript strict、ESLint 準拠
- 表示/UX: 5段階ブレークポイントでのレスポンシブ確認、ダークモード確認
- パフォーマンス: Lighthouse/CWV 測定、画像最適化/遅延読み込み確認
- アクセシビリティ: スクリーンリーダー/キーボード操作の基本動作確認

## 16. リスク・課題
- microCMS 依存: API 障害時のフォールバック（空配列/メッセージ表示）
- 問い合わせ送信: 現状はデモ（実送信 API 未実装）。スパム/レート制御/通知設計が必要
- バージョン差異: 一部定数に旧バージョン表記が残存（要整合性確認）

## 17. 今後の拡張（ロードマップ合意事項）
- Phase 1: NextAuth.js による認証（Google/GitHub OAuth、JWT、セッション、Middleware）
- Phase 2: Stripe 決済/サブスク（Checkout、Webhook、請求/プラン管理）
- Phase 3: DB/ORM（PostgreSQL + Prisma、Redis、Blob）
- Phase 4: コミュニティ/分析（コメント、検索、GA/Sentry、PWA、i18n）

## 18. 受け入れ基準（現行）
- 主要ページが要件どおり表示・遷移できる
- microCMS 記事/Works が反映される（最新3件/注目3件）
- サイドバー API が正常応答し、件数が表示される
- 問い合わせフォームのバリデーション/確認モーダルが機能する
- `POST /api/contact` が 200/202 を返し、Resend が設定されていれば通知メールが配信される
- Lighthouse 95 点以上、主要ブレークポイントで UI 崩れがない

## 19. 変更履歴
- 2025-09-15 初版作成（現状コードと各種ドキュメントを統合）

---

補足: 本書は現行実装から逆算して作成した要件定義の初版。運用開始後の知見や利害関係者の合意に合わせ、版管理しながら更新する。
